<!DOCTYPE html>
<html>
  <head>
    <title>Base D3 Map</title>
    <style>
      html, body { height: 100%; font-family: Helvetica, Arial; color: #333; }
      #map { width: 100%; height: 100%; }
      #loading { text-align: center; margin-top: 30%; font-size: 11px; }
      .counties {
        fill: none;
        stroke: #AAA;
        stroke-linejoin: round;
        stroke-linecap: round;
      }
      .circles {
        fill: #00cc9a;
        fill-opacity: .5;
        stroke: #fff;
        stroke-width: .5px;
      }
    </style>

  </head>
  <body>

    <div id="map">
      <p id="loading">Almost done...</p>
    </div>

    <!-- loading d3 core library -->
    <!-- latest version at http://d3js.org/ -->
    <!-- documentation at https://github.com/mbostock/d3/wiki -->
    <script src="lib/d3/d3.min.js" charset="UTF-8"></script>

    <!-- loading topojson client-side JS library -->
    <!-- this is used to convert topojson back to geojson -->
    <script src="lib/topojson/topojson.js"></script>

    <!-- simple geojson file containing one variable named 'data' -->
    <script src="data/2010_us_20m_topojson.js"></script>

    <script>
      var data = topojson.feature(data, data.objects['2010_us_20m']);
      console.log(data);

      var width = 960;
      var height = 800;
      var path = d3.geo.path()
      // path.projection(d3.geo.stereographic().scale(525).translate([900,950]))

      var areas = data.features.map(function(feature) {
        return path.area(feature);
      });

      // We'll be using a d3.scale.sqrt here, so that the area of the circle
      // is proportional to the area of the polygon. The radius of the circle
      // is porportional to the root of the population.
      // https://github.com/mbostock/d3/wiki/Quantitative-Scales#sqrt
      //
      // d3.extent simply gives the minimum and maximum of an array of values
      // in the format [min, max].
      // https://github.com/mbostock/d3/wiki/Arrays#d3_extent
      var scale = d3.scale.sqrt()
        .domain(d3.extent(areas))
        .range([.5, 20]);

      var svg = d3.select('#map').append('svg')
        .attr('width', width)
        .attr('height', height);

      // When working with multiple 'layers' of data, it's important
      // that we can easily keep track of what's what.
      // In SVG, a <g> element is a simple grouping. You can think of it
      // as a <div>. It's useful for organizing stuff.
      svg.append('g')
        .attr('class', 'counties')
      .selectAll('path')
        .data(data.features)
      .enter().append('path')
        .attr('class', 'county')
        .attr('d', path);

      // To note here: a circle usually requires x and y attributes.
      // SVG will treat these coordinates as the center of the circle.
      // The r attribute is the radius.
      // We omit x and y, which defaults the coordinate to (0,0),
      // and instead translate the circle to where it should be.
      svg.append('g')
        .attr('class', 'circles')
      .selectAll('circle')
        .data(data.features)
      .enter().append('circle')
        .attr('transform', function(d) { return 'translate(' + path.centroid(d) + ')'; })
        .attr('r', function(d) { return scale(path.area(d)); })
        .on('mouseover', function(d) {
          console.log(d);
        });

      d3.select('#loading').style('display', 'none');
    </script>

  </body>
</html>
