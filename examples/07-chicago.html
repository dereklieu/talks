<!DOCTYPE html>
<html>
  <head>
    <title>Chicago</title>
    <link rel="stylesheet" type="text/css" href="lib/d3tip/d3tip.css" />
    <style>
      html, body { height: 100%; font-family: Helvetica, Arial; color: #333; }
      #map { width: 100%; height: 100%; }
      #loading { text-align: center; margin-top: 30%; font-size: 11px; }
      .areas {
        fill: none;
        stroke: #AAA;
        stroke-linejoin: round;
        stroke-linecap: round;
      }
      .circles {
        fill: #00cc9a;
        fill-opacity: .5;
        stroke: #fff;
        stroke-width: .5px;
      }
      line {
        stroke: #999;
      }
    </style>

  </head>
  <body>

    <div id="map">
      <p id="loading">Almost done...</p>
    </div>

    <script src="lib/d3/d3.min.js" charset="UTF-8"></script>
    <script src="lib/d3tip/d3tip.js"></script>
    <script src="lib/topojson/topojson.js"></script>
    <script src="data/2014_chicago_crimes_by_ward.js"></script>

    <script>
      var areas = topojson.feature(data, data.objects.community_areas);

      var width = 960;
      var height = 800;
      var projection = d3.geo.albersUsa()
        .scale(55000).translate([-5900, 3500])
      var path = d3.geo.path().projection(projection);

      var crimeCounts = areas.features.map(function(d) {
        return +d.properties.crimes;
      });

      var fill = d3.scale.quantile()
        .domain(crimeCounts)
        .range(['rgb(254,237,222)','rgb(253,190,133)','rgb(253,141,60)','rgb(230,85,13)','rgb(166,54,3)']);

      var tip = d3.tip().attr('class', 'd3-tip').html(function(d) {
        return '<h2>' + d.properties.name +
          '</h2>' + '<span>Crimes: <b>' +
            d.properties.crimes + '</b></span>'
      });

      var svg = d3.select('#map').append('svg')
        .attr('width', width)
        .attr('height', height)
        .call(tip);

      var areas = svg.append('g')
        .attr('class', 'areas')
      .selectAll('path')
        .data(areas.features)
      .enter().append('path')
        .style('fill', function(d) { return fill(d.properties.crimes); })
        .on('mouseover', tip.show)
        .on('mouseout', tip.hide)
        .attr('d', path);

      d3.select('#loading').style('display', 'none');

    </script>

  </body>
</html>
